<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <title>Watabou-style Village Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="app">
    <header>
      <div>
        <p class="tagline">Procedural village generator</p>
        <h1>Rustic Settlement</h1>
        <p class="subtitle">
          Bigger roads, clearer parcels, and readable houses.
        </p>
      </div>
      <div class="links">
        <a href="https://watabou.itch.io/village-generator" target="_blank" rel="noopener">Watabou village generator</a>
      </div>
    </header>

    <main>
      <canvas id="map" width="900" height="900"></canvas>
      <aside>
        <div class="toolbar">
          <label>
            Seed
            <input type="number" id="seed" value="834711" />
          </label>
          <div class="buttons">
            <button id="regenerate">Regenerate village</button>
            <button id="randomize">Randomize seed</button>
          </div>
        </div>
        <div class="grid-controls">
          <div class="grid-controls__header">
            <div>
              <p class="tagline" style="margin:0;">Live grid</p>
              <h2>Power network</h2>
            </div>
            <span id="grid-status">awaiting grid</span>
          </div>
          <div class="grid-controls__info">
            <div>
              <span>Grid ID</span>
              <strong id="grid-id">—</strong>
            </div>
            <div>
              <span>Sim time</span>
              <strong id="grid-time">0.0</strong>
            </div>
            <div>
              <span>Nodes</span>
              <strong id="grid-nodes">0</strong>
            </div>
          </div>
          <label class="grid-controls__backend">
            Backend URL
            <input type="text" id="backend-url" value="http://localhost:8000" />
          </label>
          <div class="grid-controls__actions">
            <button id="create-grid" class="primary">Create grid</button>
            <button id="simulate-grid" class="secondary" disabled>Sim tick</button>
            <button id="fault-line" class="warning" disabled>Trigger fault</button>
          </div>
          <div class="consumer-editor">
            <div class="consumer-editor__header">
              <p class="tagline" style="margin:0;">Consumer editor</p>
              <span class="hint">Adjust base power / cosφ</span>
            </div>
            <label>
              Select consumer
              <select id="consumer-select"></select>
            </label>
            <label>
              Base (kW)
              <input type="number" id="consumer-base" step="0.1" min="0.1" />
            </label>
            <label>
              cosφ
              <input type="number" id="consumer-cosphi" step="0.01" min="0.5" max="1" />
            </label>
            <button id="consumer-update" class="secondary" disabled>Apply</button>
          </div>
          <div class="line-editor">
            <div class="line-editor__header">
              <p class="tagline" style="margin:0;">Line control</p>
              <span class="hint">Force sectionalizers</span>
            </div>
            <label>
              Line
              <select id="line-select"></select>
            </label>
            <label>
              Status
              <select id="line-status">
                <option value="online">Online</option>
                <option value="open">Open</option>
                <option value="faulted">Faulted</option>
              </select>
            </label>
            <button id="line-set-status" class="secondary" disabled>Set status</button>
          </div>
          <div class="network-management">
            <section class="element-form">
              <h3>Добавить узел</h3>
              <label>
                Тип узла
                <select id="node-type-select">
                  <option value="pole">Pole</option>
                  <option value="consumer">Consumer</option>
                  <option value="transformer">Transformer</option>
                  <option value="source">Source</option>
                </select>
              </label>
              <label>
                Позиция X
                <input type="number" id="node-pos-x" step="1" value="0" />
              </label>
              <label>
                Позиция Y
                <input type="number" id="node-pos-y" step="1" value="0" />
              </label>
              <label>
                Мощность (kW, для Consumer/Pole)
                <input type="number" id="node-base" step="0.1" placeholder="0.0" />
              </label>
              <label>
                Профиль (Consumer)
                <select id="node-profile">
                  <option value="residential">residential</option>
                  <option value="commercial">commercial</option>
                  <option value="industrial">industrial</option>
                  <option value="nightlife">nightlife</option>
                </select>
              </label>
              <label>
                cosφ (Consumer)
                <input type="number" id="node-cosphi" step="0.01" min="0.5" max="1" value="0.95" />
              </label>
              <button id="add-node-btn" class="secondary">Brush nodes</button>
            </section>
            <section class="element-form">
              <h3>Добавить линию</h3>
              <label>
                От узла
                <select id="line-node-from"></select>
              </label>
              <label>
                К узлу
                <select id="line-node-to"></select>
              </label>
              <label>
                Длина (км)
                <input type="number" id="line-length" step="0.5" value="12" />
              </label>
              <label>
                Пропускная способность (kVA)
                <input type="number" id="line-capacity" step="5" value="100" />
              </label>
            <button id="add-line-btn" class="secondary">Connect nodes</button>
            </section>
          <div class="brush-hint">
            <span id="brush-status">Brush inactive — select a tool above</span>
            <p class="brush-hint__note">Click on nodes to start/end line while Connect nodes is active.</p>
          </div>
          </div>
          <div class="network-monitor">
            <div class="monitor-header">
              <h3>Мониторинг сети</h3>
              <span class="hint">Срез по узлам и линиям</span>
            </div>
            <div class="monitor-grid">
              <div>
                <h4>Узлы</h4>
                <ul id="node-monitor"></ul>
              </div>
              <div>
                <h4>Линии</h4>
                <ul id="line-monitor"></ul>
              </div>
            </div>
          </div>
        </div>
        <p class="description">
          Click “Regenerate” after changing the seed to get the same layout again. Fields, clusters, and roads all reuse
          the same random stream.
        </p>
        <ul>
          <li>Field outlines keep the outskirts readable.</li>
          <li>Roads and alleys are separated by thickness.</li>
          <li>House block sizes mimic the hand-drawn style.</li>
        </ul>
        <footer>
          <p>Canvas-only, offline generator — no frameworks required.</p>
        </footer>
      </aside>
    </main>
    <div id="node-menu" class="node-menu hidden">
      <div class="node-menu__header">
        <span id="node-menu-title">Узел</span>
        <button id="node-menu-close">×</button>
      </div>
      <div class="node-menu__body">
        <label>
          Base (kW)
          <input type="number" id="node-menu-base" step="0.1" />
        </label>
        <label>
          cosφ
          <input type="number" id="node-menu-cosphi" step="0.01" min="0.5" max="1" />
        </label>
      </div>
      <div class="node-menu__actions">
        <button id="node-menu-save" class="secondary small">Сохранить</button>
      </div>
    </div>
  </div>
  <script type="module" src="app.js"></script>
</body>

</html>
